<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>车辆保险登记*</title>
    <link th:href="@{/css/view.css}" rel="stylesheet">
    <link th:href="@{/css/font-awesome.min.css}" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}" media="all"/>
    <style>
        .cke {
            visibility: hidden;
        }
    </style>
</head>
<body id="colloaBody">
<table style="min-width:950px;width:100%;height:100%;" cellpadding="0" cellspacing="0" border="0">
    <tbody>
    <tr valign="top">
        <td>&nbsp;</td>
        <td id="colloaForm">
            <div class="formTaskflowContainer">
                <form class="formTaskflow" id="carAccidentForm" method="post"
                      th:action="@{/carDispatch/carAccidentAdd}">

                    <div>&nbsp;</div>
                    <div style="TEXT-ALIGN: center"><span style="FONT-SIZE: 20px"><strong>车辆事故登记单</strong></span></div>
                    <div>
                        <table class="tableListBorder" style="TABLE-LAYOUT: fixed" cellspacing="0" cellpadding="0"
                               align="center"
                               border="0">
                            <colgroup>
                                <col width="150">
                                <col width="300">
                                <col width="150">
                                <col>
                            </colgroup>
                            <tbody>
                            <tr>
                                <td style="TEXT-ALIGN: center"><span style="COLOR: rgb(255,0,0)">*</span>驾驶员</td>
                                <td id="dbf.text1" dbf.type="required" dbf.source="">
                                    <input id="e.dbf.text1" name="driver" class="fieldEditable">
                                </td>
                                <td style="TEXT-ALIGN: center"><span style="COLOR: rgb(255,0,0)">*</span>车牌号</td>
                                <td id="dbf.text0" dbf.type="required!0" dbf.key="">
                                    <input name="carbrand" class="fieldEditable">
                                </td>
                            </tr>
                            <tr>
                                <td style="TEXT-ALIGN: center"><span style="COLOR: rgb(255,0,0)">*</span>事故时间</td>
                                <td id="dbf.time0" dbf.type="date,required" dbf.source="datetime">
                                    <input id="test1" name="accidenttime" class="fieldEditable">
                                </td>
                                <td style="TEXT-ALIGN: center" dbf.type="" dbf.source=""><span
                                        style="COLOR: rgb(255,0,0)">*</span>事故地点
                                </td>
                                <td id="dbf.text2" dbf.type="required" dbf.source="">
                                    <input id="e.dbf.text2" name="accidentplace" class="fieldEditable">
                                </td>
                            </tr>
                            <tr>
                                <td style="TEXT-ALIGN: center">事故详情</td>
                                <td id="事故详情" colspan="3" dbf.type="" dbf.source="">
                                    <textarea id="e.事故详情" name="accidentdetails" class="fieldEditable"
                                              style="HEIGHT: 80px"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td style="TEXT-ALIGN: center">责任认定</td>
                                <td id="责任认定">
                                    <input id="e.责任认定" name="responsibility" class="fieldEditable">
                                </td>
                                <td style="TEXT-ALIGN: center">维修厂家</td>
                                <td id="维修厂家">
                                    <input id="e.维修厂家" name="maintenancefactory" class="fieldEditable">
                                </td>
                            </tr>
                            <tr>
                                <td style="TEXT-ALIGN: center">送修日期</td>
                                <td id="dbf.time1" dbf.type="date" dbf.source="date">
                                    <input id="test2" name="repairdate" class="fieldEditable">
                                </td>
                                <td style="TEXT-ALIGN: center">维修结束日期</td>
                                <td id="dbf.time2" dbf.type="date" dbf.source="date">
                                    <input id="test3" name="repairenddate" class="fieldEditable">
                                </td>
                            </tr>
                            <tr>
                                <td style="TEXT-ALIGN: center">车损费</td>
                                <td id="车损费" dbf.type="amount" dbf.source="">
                                    <input id="e.车损费" name="damagefee" class="fieldEditable textAmount">
                                </td>
                                <td style="TEXT-ALIGN: center">保险理赔金额</td>
                                <td id="保险理赔金额" dbf.type="amount" dbf.source="">
                                    <input id="e.保险理赔金额" name="insuranceclaimamount" class="fieldEditable textAmount">
                                </td>
                            </tr>
                            <tr>
                                <td style="TEXT-ALIGN: center">驾驶员承担金额</td>
                                <td id="驾驶员承担金额" dbf.type="amount" dbf.source="">
                                    <input id="e.驾驶员承担金额" name="driverborneamount" class="fieldEditable textAmount">
                                </td>
                                <td style="TEXT-ALIGN: center">维修费用</td>
                                <td id="维修费用" dbf.type="amount" dbf.source="">
                                    <input id="e.维修费用" name="maintenancecosts" class="fieldEditable textAmount"></td>
                            </tr>
                            <tr>
                                <td style="TEXT-ALIGN: center">维修内容</td>
                                <td id="维修内容" colspan="3" dbf.type="" dbf.source="">
                                    <textarea id="e.维修内容" name="maintenancecontents" class="fieldEditable"
                                              style="HEIGHT: 80px"></textarea></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>&nbsp;</div>
                    <table class="tableForm" style="TABLE-LAYOUT: fixed" cellspacing="0" cellpadding="0" align="center"
                           border="0">
                        <colgroup>
                            <col width="60">
                            <col>
                        </colgroup>
                        <tbody>
                        <tr>
                            <td style="TEXT-ALIGN: right">附件:</td>
                            <td id="attachments" dbf.source="files">
                                <input type="hidden" name="enclosure" id="url_test">
                                <input id="enclosureId1" type="hidden" name="filename">
                                <a id="enclosureId" target="_blank"></a>
                                <button type="button" class="layui-btn-sm" id="upload" style="float: right">
                                    上传附件
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </form>
            </div>
            <form method="post"><input type="hidden" id="viewState" name="viewState"></form>

            <br>
            <div id="_vWorkflowActionsStatus" style="float:left;"></div>
            <div id="_vWorkflowActionsShow" align="right">
                <a id="submitBtn" class="button" style="cursor: pointer;">确定</a>
                <a id="cancelBtn" class="button" style="cursor: pointer;">取消</a>
            </div>
            <br>

        </td>
        <td>&nbsp;</td>
    </tr>
    </tbody>
</table>
<script src="/vendor/jquery/jquery.min.js"></script>

<script type="text/javascript" th:src="@{/layui/layui.js}"></script>
<script>
    layui.use(['form', 'layer', 'jquery', 'upload', 'laydate'], function () {
        form = layui.form;
        layer = layui.layer;
        $ = layui.jquery;
        upload = layui.upload;
        var laydate = layui.laydate;

        laydate.render({
            elem: '#test1',
            type: 'datetime'
        });

        datemax = new Date();
        laydate.render({
            elem: '#test2'
        });
        laydate.render({
            elem: '#test3'
        });


        var uploadInst = upload.render({
            elem: '#upload' //绑定元素
            , url: '/upload' //上传接口
            , accept: 'file'
            , before: function (obj) {
                obj.preview(function (index, file, result) {
                    $("#enclosureId").text(file.name);
                    $("#enclosureId1").val(file.name);
                    console.log(index + " " + file.name + " " + result);
                });
            }
            , done: function (res) {
                //上传完毕回调
                if (res.code == 0) {
                    layer.msg("文件上传成功", {icon: 1});
                    console.log(res.data);
                    //$("#imgs").append("<img src=http://"+res.data+" width='300px' height='225px' style='margin-left: 8px'>");
                    $("#enclosureId").attr("href", "http://" + res.data);
                    $("#enclosureId").click(function () {
                        window.open("http://" + res.data);
                    });
                    $("#url_test").val(res.data);
                } else {
                    layer.msg("文件上传失败", {icon: 2});
                }
            }
            , error: function () {
                //请求异常回调

            }
        });
        $(function () {
            $("input").attr("autocomplete", "off");
        });

        $("#submitBtn").click(function () {
            if (confirm("是否提交表单")) {
                $("#carAccidentForm").submit();
            }
        });

        $("#cancelBtn").click(function () {
            if(confirm("是否取消提交表单，并关闭该页面")){
                window.opener=null;
                window.open('','_self');
                window.close();
            }
        });
    });

</script>
</body>
</html>
