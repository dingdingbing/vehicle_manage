<!DOCTYPE html>
<!-- saved from url=(0125)http://cn.colloa.com/test/view/formTaskflow.aspx?context=1028885&name=%e8%bd%a6%e8%be%86%e5%b9%b4%e6%a3%80%e7%99%bb%e8%ae%b0* -->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>编辑车辆保险登记*</title>
    <link th:href="@{/css/view.css}" rel="stylesheet">
    <link th:href="@{/css/font-awesome.min.css}" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}" media="all"/>
    <style>
        .cke {
            visibility: hidden;
        }
    </style>
</head>
<body id="colloaBody">
<table style="min-width:950px;width:100%;height:100%;" cellpadding="0" cellspacing="0" border="0">
    <tbody>
    <tr valign="top">
        <td>&nbsp;</td>
        <td id="colloaForm">
            <div class="formTaskflowContainer">
                <form class="formTaskflow" id="carInspectionForm" method="post" th:action="@{/carDispatch/carInspectionUpdate}">


                    <div style="TEXT-ALIGN: center"><span style="FONT-SIZE: 20px"><strong>编辑车辆年检登记单 [[${inspection.getInspectionno()}]]</strong></span></div>
                    <div>
                        <table class="tableListBorder" style="TABLE-LAYOUT: fixed" cellspacing="0" cellpadding="0"
                               align="center"
                               border="0">
                            <colgroup>
                                <col width="150">
                                <col width="300">
                                <col width="150">
                                <col>
                            </colgroup>
                            <tbody>
                            <tr>
                                <td style="TEXT-ALIGN: center"><span style="COLOR: rgb(255,0,0)">*</span>申请人</td>
                                <td id="dbf.operator" dbf.type="required" >
                                    <input type="hidden" name="inspectionno" th:value="${inspection.getInspectionno()}">
                                    <input name="applicant" th:value="${inspection.getApplicant()}" class="fieldEditable">
                                </td>
                                <td style="TEXT-ALIGN: center"><span style="COLOR: rgb(255,0,0)">*</span>申请日期</td>
                                <td id="dbf.time2" dbf.type="date,required">
                                    <input name="applicationdate" th:value="${#dates.format(inspection.getApplicationdate(),'yyyy-MM-dd')}" id="test1" class="fieldEditable">
                                </td>
                            </tr>
                            <tr>
                                <td style="TEXT-ALIGN: center"><span style="COLOR: rgb(255,0,0)">*</span>主题</td>
                                <td id="dbf.division" dbf.type="required" >
                                    <input name="theme" th:value="${inspection.getTheme()}" class="fieldEditable">
                                </td>
                                <td style="TEXT-ALIGN: center"><span style="COLOR: rgb(255,0,0)">*</span>车牌号</td>
                                <td id="dbf.text0" dbf.type="required!0" dbf.key="">
                                    <input name="carbrand" th:value="${inspection.getCarbrand()}" class="fieldEditable">
                                </td>
                            </tr>
                            <tr>
                                <td style="TEXT-ALIGN: center">年检地点</td>
                                <td id="修配厂">
                                    <input name="inspectionplace" th:value="${inspection.getInspectionplace()}" id="e.修配厂" class="fieldEditable">
                                </td>

                                <td style="TEXT-ALIGN: center">联系电话</td>

                                <td id="联系电话">
                                    <input name="phonenumber" th:value="${inspection.getPhonenumber()}" id="e.联系电话" class="fieldEditable">
                                </td>
                            </tr>
                            <tr>
                                <td style="TEXT-ALIGN: center">费用(元)</td>
                                <td id="dbf.budget" dbf.type="amount" dbf.source="">
                                    <input name="cost" id="e.dbf.budget" class="fieldEditable textAmount" th:value="${inspection.getCost()}"></td>
                                <td style="TEXT-ALIGN: center" dbf.type="" dbf.source="">经办人</td>
                                <td id="dbf.text1" dbf.type="" dbf.source="">
                                    <input name="chargeperson" th:value="${inspection.getChargeperson()}" id="e.dbf.text1" class="fieldEditable">
                                </td>
                            </tr>
                            <tr>
                                <td style="TEXT-ALIGN: center"><span style="COLOR: rgb(255,0,0)">*</span>本次年检日期</td>
                                <td id="dbf.time0" dbf.type="date,required" dbf.source="date">
                                    <input id="test2" name="thisinspectiondate" th:value="${#dates.format(inspection.getThisinspectiondate(),'yyyy-MM-dd')}" class="fieldEditable">
                                </td>
                                <td style="TEXT-ALIGN: center"><span style="COLOR: rgb(255,0,0)">*</span>下次年检日期</td>
                                <td id="dbf.time1" dbf.type="date,required" dbf.source="date">
                                    <input id="test3" name="nextinspectiondate" th:value="${#dates.format(inspection.getNextinspectiondate(),'yyyy-MM-dd')}" class="fieldEditable">
                                </td>
                            </tr>
                            <tr>
                                <td style="TEXT-ALIGN: center">备注</td>
                                <td id="备注" colspan="3" dbf.type="" dbf.source="">
                                    <input name="remarks" th:value="${inspection.getRemarks()}" id="e.备注" class="fieldEditable">
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>&nbsp;</div>
                    <table class="tableForm" style="TABLE-LAYOUT: fixed" cellspacing="0" cellpadding="0" align="center"
                           border="0">
                        <colgroup>
                            <col width="60">
                            <col>
                        </colgroup>
                        <tbody>
                        <tr>
                            <td style="TEXT-ALIGN: right">附件:</td>
                            <td id="attachments" dbf.source="files">
                                <input type="hidden" name="enclosure" id="url_test" th:value="${inspection.getEnclosure()}">
                                <input id="enclosureId1" type="hidden"  name="filename" th:value="${inspection.getFilename()}"  ><a id="enclosureId" target="_blank" th:text="${inspection.getFilename()}" th:href="${#strings.isEmpty(inspection.getEnclosure())?'':'http://'+inspection.getEnclosure()}" ></a>
                                <button type="button" class="layui-btn-sm" id="upload" style="float: right">
                                    上传附件
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </form>
            </div>
            <form method="post"><input type="hidden" id="viewState" name="viewState"></form>

            <br>
            <div id="_vWorkflowActionsStatus" style="float:left;"></div>
            <div id="_vWorkflowActionsShow" align="right">
                <a id="submitBtn" class="button" style="cursor: pointer;">确定</a>
                <a id="cancelBtn" class="button" style="cursor: pointer;">取消</a>
            </div>

        </td>
        <td>&nbsp;</td>
    </tr>
    </tbody>
</table>

<script src="/vendor/jquery/jquery.min.js"></script>

<script type="text/javascript" th:src="@{/layui/layui.js}"></script>
<script>
    layui.use(['form', 'layer', 'jquery', 'upload', 'laydate'], function () {
        form = layui.form;
        layer = layui.layer;
        $ = layui.jquery;
        upload = layui.upload;
        var laydate = layui.laydate;

        laydate.render({
            elem: '#test1',
        });

        datemax = new Date();
        laydate.render({
            elem: '#test2'
        });
        laydate.render({
            elem: '#test3'
        });


        var uploadInst = upload.render({
            elem: '#upload' //绑定元素
            , url: '/upload' //上传接口
            , accept: 'file'
            , before: function (obj) {
                obj.preview(function (index, file, result) {
                    $("#enclosureId").text(file.name);
                    $("#enclosureId1").val(file.name);
                    console.log(index + " " + file.name + " " + result);
                });
            }
            , done: function (res) {
                //上传完毕回调
                if (res.code == 0) {
                    layer.msg("文件上传成功", {icon: 1});
                    console.log(res.data);
                    //$("#imgs").append("<img src=http://"+res.data+" width='300px' height='225px' style='margin-left: 8px'>");
                    $("#enclosureId").attr("href", "http://" + res.data);
                    $("#enclosureId").click(function () {
                        window.open("http://" + res.data);
                    });
                    $("#url_test").val(res.data);
                } else {
                    layer.msg("文件上传失败", {icon: 2});
                }
            }
            , error: function () {
                //请求异常回调

            }
        });
        $(function () {
            $("input").attr("autocomplete", "off");
        });

        $("#submitBtn").click(function () {
            if (confirm("是否提交表单")) {
                $("#carInspectionForm").submit();
            }
        });
        $("#cancelBtn").click(function () {
            if(confirm("是否取消提交表单，并关闭该页面")){
                window.opener=null;
                window.open('','_self');
                window.close();
            }
        });
    });

</script>

</body>
</html>
